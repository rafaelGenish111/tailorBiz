<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glass Dynamic - Pro Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* עיצוב גלילה */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 h-screen flex overflow-hidden font-sans">

    <aside class="w-64 bg-slate-900 border-l border-slate-800 hidden md:flex flex-col z-20 shadow-xl shrink-0">
        <div class="p-6">
            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">Glass Dynamic</h1>
            <p class="text-xs text-slate-400 mt-1">גרסה 4.0 (Pro)</p>
        </div>
        
        <nav class="flex-1 px-4 space-y-2">
            <button onclick="navTo('dashboard')" id="nav-dashboard" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                <i data-lucide="layout-dashboard"></i> <span class="font-medium">מרכז שליטה</span>
            </button>
            <button onclick="navTo('crm')" id="nav-crm" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                <i data-lucide="users"></i> <span class="font-medium">לקוחות והזמנות</span>
            </button>
            <button onclick="navTo('suppliers')" id="nav-suppliers" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                <i data-lucide="shopping-cart"></i> <span class="font-medium">רכש וספקים</span>
            </button>
            <button onclick="navTo('production')" id="nav-production" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                <i data-lucide="factory"></i> <span class="font-medium">פס ייצור</span>
            </button>
            <button onclick="navTo('installer')" id="nav-installer" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                <i data-lucide="smartphone"></i> <span class="font-medium">אפליקציית מתקין</span>
            </button>
        </nav>
    </aside>

    <main class="flex-1 relative bg-slate-950 overflow-hidden flex flex-col">
        <div class="md:hidden p-4 bg-slate-900 border-b border-slate-800 flex justify-between items-center">
            <h1 class="font-bold text-blue-400">Glass Dynamic</h1>
            <button onclick="navTo('dashboard')" class="text-white"><i data-lucide="home"></i></button>
        </div>

        <div class="flex-1 overflow-y-auto p-6 relative" id="main-container">
            
            <div id="view-dashboard" class="view hidden max-w-6xl mx-auto fade-in">
                <header class="mb-8">
                    <h2 class="text-3xl font-bold text-white">בוקר טוב, רפאל</h2>
                    <p class="text-slate-400">סקירה מערכתית</p>
                </header>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                        <p class="text-slate-400 text-sm">הזמנות פעילות</p>
                        <h3 class="text-4xl font-bold text-white mt-2" id="stat-active">0</h3>
                    </div>
                    <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-1 h-full bg-amber-500"></div>
                        <p class="text-slate-400 text-sm">פריטי רכש להזמנה</p>
                        <h3 class="text-4xl font-bold text-white mt-2" id="stat-purchasing">0</h3>
                    </div>
                    <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-1 h-full bg-emerald-500"></div>
                        <p class="text-slate-400 text-sm">התקנות פתוחות</p>
                        <h3 class="text-4xl font-bold text-white mt-2" id="stat-install">0</h3>
                    </div>
                </div>
            </div>

            <div id="view-crm" class="view hidden max-w-6xl mx-auto fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">לקוחות והזמנות</h2>
                    <button onclick="openNewOrderModal()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 font-medium shadow-lg shadow-blue-900/20 active:scale-95 transition">
                        <i data-lucide="plus"></i> הזמנה חדשה
                    </button>
                </div>
                <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden">
                    <table class="w-full text-right text-sm">
                        <thead class="bg-slate-800/50 text-slate-400">
                            <tr>
                                <th class="p-4">לקוח</th>
                                <th class="p-4">כתובת</th>
                                <th class="p-4">סטטוס</th>
                                <th class="p-4">כמות פריטים</th>
                                <th class="p-4"></th>
                            </tr>
                        </thead>
                        <tbody id="crm-table-body" class="divide-y divide-slate-800 text-slate-300"></tbody>
                    </table>
                </div>
            </div>

            <div id="view-client-card" class="view hidden max-w-5xl mx-auto fade-in">
                <button onclick="navTo('crm')" class="text-slate-400 hover:text-white mb-4 flex items-center gap-2 text-sm"><i data-lucide="arrow-right" size="16"></i> חזרה לרשימה</button>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-6">
                        <div class="bg-slate-900 rounded-2xl p-6 border border-slate-800 relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-cyan-400"></div>
                            <div class="flex justify-between items-start">
                                <div>
                                    <h1 class="text-2xl font-bold text-white mb-2" id="card-name">שם לקוח</h1>
                                    <div class="flex flex-col gap-1 text-slate-400 text-sm">
                                        <p class="flex items-center gap-2"><i data-lucide="map-pin" size="14"></i> <span id="card-address">כתובת</span></p>
                                        <p class="flex items-center gap-2"><i data-lucide="phone" size="14"></i> <span id="card-phone">050-0000000</span></p>
                                    </div>
                                </div>
                                <span id="card-status" class="px-3 py-1 rounded-full text-xs font-bold bg-slate-800 text-white border border-slate-700">סטטוס</span>
                            </div>
                        </div>

                        <div class="bg-slate-900 rounded-2xl border border-slate-800 overflow-hidden">
                            <div class="p-4 bg-slate-800/50 border-b border-slate-800 font-bold text-white flex items-center gap-2">
                                <i data-lucide="list"></i> פירוט הזמנה
                            </div>
                            <table class="w-full text-sm text-right">
                                <thead class="text-slate-500 bg-slate-900/50">
                                    <tr><th class="p-3">מוצר</th><th class="p-3">תיאור</th><th class="p-3">ספק</th><th class="p-3">סטטוס רכש</th></tr>
                                </thead>
                                <tbody id="card-items-body" class="text-slate-300 divide-y divide-slate-800"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-slate-900 rounded-2xl p-5 border border-slate-800">
                            <h3 class="font-bold text-white mb-4 flex items-center gap-2"><i data-lucide="folder"></i> מסמכים וקבצים</h3>
                            <div class="space-y-3">
                                <div class="flex items-center gap-3 p-3 bg-slate-800 rounded-lg cursor-pointer hover:bg-slate-700 transition">
                                    <div class="bg-blue-900/50 p-2 rounded text-blue-400"><i data-lucide="file-text"></i></div>
                                    <div class="text-sm">
                                        <p class="text-white font-medium">הצעת מחיר חתומה</p>
                                        <p class="text-slate-500 text-xs">PDF • 1.2MB</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-slate-800 rounded-lg cursor-pointer hover:bg-slate-700 transition">
                                    <div class="bg-purple-900/50 p-2 rounded text-purple-400"><i data-lucide="image"></i></div>
                                    <div class="text-sm">
                                        <p class="text-white font-medium">תוכניות אדריכל</p>
                                        <p class="text-slate-500 text-xs">JPG • 4.5MB</p>
                                    </div>
                                </div>
                                <button class="w-full border border-dashed border-slate-600 rounded-lg py-3 text-slate-400 text-sm hover:text-white hover:border-blue-500 transition">
                                    + העלה קובץ חדש
                                </button>
                            </div>
                        </div>

                        <div class="bg-slate-800 p-5 rounded-2xl border border-slate-700">
                            <h3 class="font-bold text-white mb-2">ניהול התקדמות</h3>
                            <p class="text-xs text-slate-400 mb-4">שינוי סטטוס יעדכן את המחלקות הרלוונטיות</p>
                            <button id="btn-advance" onclick="advanceOrderStatus()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl font-bold transition flex justify-center items-center gap-2">
                                העבר לשלב הבא
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-suppliers" class="view hidden max-w-5xl mx-auto fade-in">
                <h2 class="text-2xl font-bold text-white mb-6">רכש וספקים (Batching)</h2>
                <div id="suppliers-container" class="space-y-6"></div>
            </div>

            <div id="view-production" class="view hidden max-w-7xl mx-auto fade-in">
                <h2 class="text-2xl font-bold text-white mb-6">פס ייצור</h2>
                <div id="production-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>

            <div id="view-installer" class="view hidden w-full h-full flex justify-center items-start pt-2 fade-in">
                <div class="w-[360px] h-[720px] bg-black rounded-[3rem] border-[8px] border-slate-800 shadow-2xl relative overflow-hidden flex flex-col shrink-0">
                    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-7 bg-black rounded-b-xl z-20"></div>
                    
                    <div class="bg-slate-900 flex-1 p-5 pt-12 overflow-y-auto">
                        <div class="flex justify-between items-center mb-6">
                            <div><h2 class="text-white text-lg font-bold">היי אבי,</h2><p class="text-slate-400 text-xs">הנה העבודות שלך להיום</p></div>
                        </div>
                        <div id="installer-jobs-container" class="space-y-4"></div>
                    </div>
                </div>
            </div>

            <div id="modal-new-order" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
                <div class="bg-slate-900 w-full max-w-2xl rounded-2xl border border-slate-700 shadow-2xl flex flex-col max-h-[90vh]">
                    <div class="p-5 border-b border-slate-800 flex justify-between"><h3 class="font-bold text-lg">הזמנה חדשה</h3><button onclick="closeNewOrderModal()"><i data-lucide="x"></i></button></div>
                    
                    <div class="p-5 overflow-y-auto flex-1 space-y-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="text-xs text-slate-400">שם הלקוח</label><input type="text" id="in-name" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2.5 outline-none focus:border-blue-500"></div>
                            <div><label class="text-xs text-slate-400">כתובת</label><input type="text" id="in-address" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2.5 outline-none focus:border-blue-500"></div>
                        </div>

                        <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                            <h4 class="text-sm font-bold text-white mb-3 flex items-center gap-2"><i data-lucide="plus-square" size="16"></i> הוספת פריטים להזמנה</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                                <select id="item-product" class="bg-slate-800 border border-slate-600 rounded-lg p-2 text-xs text-white">
                                    <option value="ויטרינה">ויטרינה</option>
                                    <option value="חלון קיפ">חלון קיפ</option>
                                    <option value="דלת כניסה">דלת כניסה</option>
                                    <option value="מעקה">מעקה</option>
                                </select>
                                <input id="item-desc" type="text" placeholder="תיאור (מידות/גוון)" class="bg-slate-800 border border-slate-600 rounded-lg p-2 text-xs text-white">
                                <select id="item-supplier" class="bg-slate-800 border border-slate-600 rounded-lg p-2 text-xs text-white">
                                    <option value="קליל">ספק: קליל</option>
                                    <option value="זכוכית בע״מ">ספק: זכוכית בע״מ</option>
                                    <option value="אקסטל">ספק: אקסטל</option>
                                </select>
                            </div>
                            <button onclick="addItemToTempList()" class="w-full bg-slate-700 hover:bg-slate-600 text-xs py-2 rounded-lg font-bold border border-slate-600 mb-4">+ הוסף פריט לטבלה</button>
                            
                            <table class="w-full text-xs text-right text-slate-300">
                                <thead class="border-b border-slate-600"><tr><th>מוצר</th><th>תיאור</th><th>ספק</th></tr></thead>
                                <tbody id="temp-items-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="p-5 border-t border-slate-800 bg-slate-900 rounded-b-2xl">
                        <button onclick="submitNewOrder()" class="w-full bg-blue-600 hover:bg-blue-500 py-3 rounded-xl font-bold text-white shadow-lg">שמור ופתח הזמנה</button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- DATA & STATE ---
        let orders = [
            { 
                id: 101, name: 'משפ׳ כהן', address: 'הרותם 4, סביון', route: 'A', status: 'production', 
                items: [
                    { product: 'ויטרינה', desc: 'פרופיל 7000 אפור, 3 כנפיים', supplier: 'קליל', status: 'arrived' },
                    { product: 'זכוכית', desc: 'בידודית 6+6 שקוף', supplier: 'זכוכית בע״מ', status: 'pending' }
                ]
            }
        ];
        
        let tempItems = []; // For the modal
        let activeOrderId = null; // For Client Card
        const statusMap = { 'offer': 'הצעת מחיר', 'measure': 'מדידה', 'production': 'בייצור', 'install': 'התקנה', 'done': 'הושלם' };

        // --- NAVIGATION ---
        function navTo(viewId) {
            document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + viewId).classList.remove('hidden');
            
            // Sidebar Active State
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white', 'shadow-lg');
                btn.classList.add('text-slate-400');
            });
            const active = document.getElementById('nav-' + viewId);
            if(active && !viewId.includes('client-card')) { 
                active.classList.remove('text-slate-400'); 
                active.classList.add('bg-blue-600', 'text-white', 'shadow-lg'); 
            }

            // Render Views
            if(viewId === 'crm') renderCRM();
            if(viewId === 'suppliers') renderSuppliers();
            if(viewId === 'production') renderProduction();
            if(viewId === 'installer') renderInstaller();
            if(viewId === 'dashboard') updateStats();
            
            lucide.createIcons();
        }

        // --- VIEW: CRM ---
        function renderCRM() {
            const tbody = document.getElementById('crm-table-body');
            tbody.innerHTML = orders.map(o => `
                <tr onclick="openClientCard(${o.id})" class="hover:bg-slate-800/50 transition border-b border-slate-800 last:border-0 cursor-pointer group">
                    <td class="p-4 font-bold text-white group-hover:text-blue-400 transition">${o.name}</td>
                    <td class="p-4 text-slate-400">${o.address}</td>
                    <td class="p-4"><span class="px-2 py-1 rounded text-xs bg-slate-800 border border-slate-700">${statusMap[o.status]}</span></td>
                    <td class="p-4 text-slate-400 text-xs">${o.items.length} פריטים</td>
                    <td class="p-4 text-blue-500"><i data-lucide="chevron-left" size="16"></i></td>
                </tr>
            `).join('');
            lucide.createIcons();
        }

        // --- VIEW: CLIENT CARD ---
        function openClientCard(id) {
            activeOrderId = id;
            const o = orders.find(x => x.id === id);
            if(!o) return;

            // Fill Data
            document.getElementById('card-name').innerText = o.name;
            document.getElementById('card-address').innerText = o.address;
            document.getElementById('card-status').innerText = statusMap[o.status];
            
            // Fill Items Table
            const tbody = document.getElementById('card-items-body');
            tbody.innerHTML = o.items.map(item => `
                <tr>
                    <td class="p-3 font-medium text-white">${item.product}</td>
                    <td class="p-3 text-slate-400">${item.desc}</td>
                    <td class="p-3 text-slate-400">${item.supplier}</td>
                    <td class="p-3">
                        <span class="${item.status === 'arrived' ? 'text-emerald-400' : 'text-amber-400'} text-xs">
                            ${item.status === 'arrived' ? 'סופק' : 'ממתין'}
                        </span>
                    </td>
                </tr>
            `).join('');

            // Action Button Text
            const btn = document.getElementById('btn-advance');
            if(o.status === 'done') {
                btn.innerText = 'הפרויקט הושלם';
                btn.className = 'w-full bg-emerald-600/50 text-white py-3 rounded-xl font-bold cursor-not-allowed';
            } else {
                btn.innerText = 'העבר לשלב הבא';
                btn.className = 'w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl font-bold transition';
            }

            navTo('client-card');
        }

        function advanceOrderStatus() {
            const o = orders.find(x => x.id === activeOrderId);
            const flow = ['offer', 'measure', 'production', 'install', 'done'];
            const idx = flow.indexOf(o.status);
            if(idx < flow.length - 1) {
                o.status = flow[idx + 1];
                openClientCard(activeOrderId); // Re-render
            }
        }

        // --- NEW ORDER MODAL & LOGIC ---
        function openNewOrderModal() {
            tempItems = []; // Reset temp items
            renderTempItems();
            document.getElementById('in-name').value = '';
            document.getElementById('in-address').value = '';
            document.getElementById('modal-new-order').classList.remove('hidden');
        }
        function closeNewOrderModal() { document.getElementById('modal-new-order').classList.add('hidden'); }

        function addItemToTempList() {
            const product = document.getElementById('item-product').value;
            const desc = document.getElementById('item-desc').value;
            const supplier = document.getElementById('item-supplier').value;
            
            if(desc) {
                tempItems.push({ product, desc, supplier, status: 'pending' });
                document.getElementById('item-desc').value = ''; // clear input
                renderTempItems();
            }
        }

        function renderTempItems() {
            document.getElementById('temp-items-body').innerHTML = tempItems.map(i => `
                <tr class="border-b border-slate-700/50 last:border-0">
                    <td class="py-2 text-white font-medium">${i.product}</td>
                    <td class="py-2 text-slate-400">${i.desc}</td>
                    <td class="py-2 text-blue-400">${i.supplier}</td>
                </tr>
            `).join('');
        }

        function submitNewOrder() {
            const name = document.getElementById('in-name').value;
            const address = document.getElementById('in-address').value;
            
            if(name && tempItems.length > 0) {
                orders.push({
                    id: Date.now(),
                    name: name,
                    address: address || 'לא צוין',
                    route: 'A',
                    status: 'offer',
                    items: [...tempItems]
                });
                closeNewOrderModal();
                renderCRM();
                updateStats();
            } else {
                alert('נא למלא שם לקוח ולהוסיף לפחות פריט אחד');
            }
        }

        // --- VIEW: SUPPLIERS ---
        function renderSuppliers() {
            const container = document.getElementById('suppliers-container');
            container.innerHTML = '';
            const suppliersMap = {};
            
            orders.forEach(order => {
                if (order.status !== 'done' && order.status !== 'offer') {
                    order.items.forEach(item => {
                        if (item.status === 'pending') {
                            if (!suppliersMap[item.supplier]) suppliersMap[item.supplier] = [];
                            suppliersMap[item.supplier].push({ ...item, client: order.name, orderId: order.id });
                        }
                    });
                }
            });

            if (Object.keys(suppliersMap).length === 0) {
                container.innerHTML = `<div class="text-center text-slate-500 py-10">אין הזמנות רכש פתוחות כרגע</div>`;
                return;
            }

            for (const [supplierName, items] of Object.entries(suppliersMap)) {
                container.innerHTML += `
                    <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden">
                        <div class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-800/30">
                            <h3 class="font-bold text-white">${supplierName} <span class="text-slate-500 text-xs font-normal">(${items.length} פריטים)</span></h3>
                            <button onclick="orderAll('${supplierName}')" class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1.5 rounded text-xs font-bold">הוצא הזמנה</button>
                        </div>
                        <div class="p-4">
                            <table class="w-full text-sm text-right text-slate-300">
                                <thead class="text-slate-500 text-xs"><th>לקוח</th><th>מוצר</th><th>תיאור</th></thead>
                                <tbody class="divide-y divide-slate-800">
                                    ${items.map(i => `<tr><td class="py-2">${i.client}</td><td class="py-2 text-white">${i.product}</td><td class="py-2 text-slate-400">${i.desc}</td></tr>`).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
        }

        function orderAll(supplier) {
            orders.forEach(o => o.items.forEach(i => { if(i.supplier === supplier) i.status = 'arrived'; }));
            alert('הזמנה נשלחה בהצלחה!');
            renderSuppliers();
            updateStats();
        }

        // --- VIEW: PRODUCTION ---
        function renderProduction() {
            const grid = document.getElementById('production-grid');
            const jobs = orders.filter(o => o.status === 'production');
            if(jobs.length === 0) { grid.innerHTML = `<div class="col-span-full text-center text-slate-500 mt-10">הקו פנוי</div>`; return; }
            
            grid.innerHTML = jobs.map(job => `
                <div class="bg-slate-900 rounded-xl border border-slate-800 p-5 relative group hover:border-blue-500/50 transition shadow-lg">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-white text-lg">${job.name}</h3>
                        <span class="text-xs bg-slate-800 px-2 py-1 rounded border border-slate-700">בייצור</span>
                    </div>
                    <div class="space-y-2 mb-6 text-sm">
                        ${job.items.map(i => `
                            <div class="flex justify-between items-center p-2 rounded bg-slate-800/50">
                                <span class="text-slate-300">${i.product} - ${i.desc}</span>
                                <span class="w-2 h-2 rounded-full ${i.status === 'arrived' ? 'bg-emerald-500' : 'bg-red-500'}"></span>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="changeStatus(${job.id}, 'install')" class="w-full bg-slate-800 hover:bg-emerald-600 text-slate-300 hover:text-white py-3 rounded-xl font-bold transition flex items-center justify-center gap-2">
                        <i data-lucide="check-circle-2"></i> סיום ודיווח
                    </button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- VIEW: INSTALLER ---
        function renderInstaller() {
            const container = document.getElementById('installer-jobs-container');
            const jobs = orders.filter(o => o.status === 'install');
            
            if(jobs.length === 0) { container.innerHTML = `<div class="text-center text-slate-500 py-10">אין עבודות כרגע</div>`; return; }

            container.innerHTML = jobs.map(job => `
                <div class="bg-blue-600 rounded-2xl p-5 shadow-lg relative overflow-hidden mb-4">
                    <div class="flex justify-between items-start mb-3 relative z-10">
                        <span class="bg-white/20 text-white text-[10px] px-2 py-1 rounded backdrop-blur-md">עכשיו</span>
                        <span class="text-blue-100 text-xs font-mono">#${job.id}</span>
                    </div>
                    <h3 class="text-white text-xl font-bold mb-1 relative z-10">${job.name}</h3>
                    <p class="text-blue-100 text-xs mb-4 flex items-center gap-1 relative z-10 opacity-80"><i data-lucide="map-pin" size="12"></i> ${job.address}</p>
                    
                    <div class="grid grid-cols-2 gap-2 relative z-10 mb-4">
                        <button class="bg-white text-blue-700 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1"><i data-lucide="navigation" size="14"></i> ניווט</button>
                        <button class="bg-blue-700 text-white border border-blue-500 py-2 rounded-lg text-xs font-medium flex items-center justify-center gap-1"><i data-lucide="phone" size="14"></i> חיוג</button>
                    </div>

                    <div class="border-t border-white/10 pt-4 mb-4 relative z-10">
                        <button onclick="alert('פותח קובץ PDF...')" class="w-full bg-blue-800/50 hover:bg-blue-800 text-white py-2 rounded-lg text-xs flex items-center justify-center gap-2 transition">
                            <i data-lucide="file-text" size="14"></i> צפה בתוכניות ושרטוטים
                        </button>
                    </div>

                    <div class="grid grid-cols-1 gap-2 relative z-10">
                        <button onclick="document.getElementById('camera-input-${job.id}').click()" class="bg-blue-500 hover:bg-blue-400 text-white py-3 rounded-xl font-bold text-xs flex items-center justify-center gap-2 border border-blue-400 border-dashed">
                            <i data-lucide="camera" size="14"></i> צלם/העלה אישור ביצוע
                        </button>
                        <input type="file" id="camera-input-${job.id}" class="hidden" accept="image/*" capture="environment" onchange="alert('תמונה נשמרה בהצלחה!')">
                        
                        <button onclick="changeStatus(${job.id}, 'done')" class="bg-emerald-500 hover:bg-emerald-400 text-white py-3 rounded-xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 mt-2">
                            <i data-lucide="check"></i> אשר סיום התקנה
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- HELPERS ---
        function updateStats() {
            document.getElementById('stat-active').innerText = orders.filter(o => o.status !== 'done').length;
            document.getElementById('stat-install').innerText = orders.filter(o => o.status === 'install').length;
            let pending = 0;
            orders.forEach(o => { if(o.status !== 'done') pending += o.items.filter(i => i.status === 'pending').length; });
            document.getElementById('stat-purchasing').innerText = pending;
        }

        function changeStatus(id, newStatus) {
            const o = orders.find(x => x.id === id);
            if(o) { o.status = newStatus; navTo(newStatus === 'done' ? 'installer' : 'production'); updateStats(); }
        }

        document.addEventListener('DOMContentLoaded', () => { lucide.createIcons(); navTo('dashboard'); });
    </script>
</body>
</html>