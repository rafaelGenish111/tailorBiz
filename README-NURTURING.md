# 🤖 Lead Nurturing System - מדריך הרצה

## 🎯 מה זה עושה?

מערכת אוטומטית שמטפלת בלידים במקומך:

- **מזהה** לידים חדשים אוטומטית
- **שולחת** הודעות follow-up בזמנים אסטרטגיים
- **יוצרת** משימות ותזכורות
- **מפסיקה** כשהליד מגיב
- **מדווחת** על ההתקדמות

## 🚀 התקנה והפעלה

### 1. הכנה

```bash
# Backend
cd backend
npm install

# וודא ש-MongoDB רץ
sudo systemctl status mongod
```

### 2. הטמעת תבניות מוכנות

```bash
cd backend
npm run seed:nurturing
```

**צפוי לראות:**

```
🌱 Seeding nurturing templates...
  ✅ Created: 💬 ליד חדש מ-WhatsApp - רצף סטנדרטי
  ✅ Created: ❄️ חימום ליד קר
  ✅ Created: 📋 Follow-up אחרי אפיון
  ✅ Created: 💼 Follow-up על הצעת מחיר
  ✅ Created: 🔥 VIP Track - ליד חם
  ✅ Created: 📱 טיפוח ליד ממדיה ממומנת
🎉 Seeding completed!
```

### 3. הרצת השרת

```bash
cd backend
npm run dev
```

**צפוי לראות:**

```
✅ MongoDB connected
🔔 Starting Reminder Service...
✅ Reminder Service is now active
🌱 Starting Lead Nurturing Service...
✅ Lead Nurturing Service is active
🚀 Server is running on port 5000
```

### 4. הרצת Frontend

```bash
cd frontend
npm start
```

## 📱 איך להשתמש?

### שיטה 1: הזנה מהירה של ליד

1. **לחץ על הכפתור הצף** בפינה השמאלית התחתונה (+ כחול)
2. **בחר מקור:** WhatsApp / טלפון / אתר / LinkedIn
3. **מלא פרטים:**
   - שם מלא ✅
   - טלפון ✅
   - שם עסק (אופציונלי)
   - מה הוא אמר/כתב
4. **לחץ "צור ליד"**

**🎉 מה קורה אחרי?**

- הליד נכנס למערכת
- Lead Score מחושב אוטומטית
- אם הציון מעל 70 → רצף VIP מתחיל
- אם הציון מעל 15 → רצף רגיל מתחיל
- תקבל משימה לטפל בו תוך 24 שעות

### שיטה 2: מתוך כרטיס לקוח

1. פתח כרטיס לקוח
2. לחץ "הפעל אוטומציה"
3. בחר תבנית
4. אשר

### שיטה 3: אוטומטי מ-WhatsApp

כשמגיעה הודעה ב-WhatsApp:

1. המערכת יוצרת ליד אוטומטית
2. מזהה את המספר
3. מפעילה רצף התאמת follow-up
4. מתריעה לך

## 🎛️ ניהול אוטומציות

### דף "אוטומציות טיפוח"

נגיש דרך: `/admin/nurturing`

**מה תראה:**

- 📊 סטטיסטיקות: כמה תבניות פעילות, כמה רצפים רצים
- 📋 רשימת תבניות: כל התבניות הזמינות
- ⚙️ הפעלה/כיבוי: כפתור להפעלה/כיבוי של כל תבנית
- 👁️ צפייה: לחץ על העין לראות את כל השלבים
- ✏️ עריכה: שנה את ההודעות והזמנים
- 🗑️ מחיקה: מחק תבנית

### דף "רצפים פעילים"

נגיש דרך: `/admin/nurturing/active`

**מה תראה:**

- 🔄 לידים שנמצאים כרגע ברצף
- 📈 התקדמות: באיזה שלב כל ליד
- ⏰ פעולה הבאה: מתי תישלח ההודעה הבאה
- 📜 היסטוריה: מה כבר נשלח
- ⏹️ הפסקה: אפשר להפסיק ידנית אם רוצה

## 📋 התבניות המוכנות

### 1. 💬 ליד חדש מ-WhatsApp

```
טריגר: ליד חדש, מקור WhatsApp, ציון מעל 15

שלב 0: יצירת משימה מיידית
שלב 1: תזכורת אחרי 24 שעות
שלב 2: הודעה ראשונה אחרי 2 ימים
שלב 3: הודעה שנייה אחרי 5 ימים
שלב 4: תיוג "לא מגיב" אחרי 7 ימים
```

### 2. ❄️ חימום ליד קר

```
טריגר: ליד ללא קשר 3+ ימים, ציון מעל 30

שלב 0: הודעת re-engagement מיידית
שלב 1: הצעת ערך אחרי 2 ימים
שלב 2: משימה למנהל אחרי 5 ימים
```

### 3. 📋 Follow-up אחרי אפיון

```
טריגר: סטטוס השתנה ל-"assessment_completed"

שלב 0: תודה והבטחה להצעה
שלב 1: משימה להכין הצעה
שלב 2: תזכורת אחרי 3 ימים
```

### 4. 💼 Follow-up על הצעת מחיר

```
טריגר: סטטוס השתנה ל-"proposal_sent"

שלב 0: וידוא קבלה מיידי
שלב 1: בדיקת סטטוס אחרי יומיים
שלב 2: דחיפה עדינה אחרי 5 ימים
שלב 3: שיחה אישית אחרי שבוע
```

### 5. 🔥 VIP Track - ליד חם

```
טריגר: ליד חדש, ציון מעל 70

שלב 0: התראה דחופה מיידית
שלב 1: משימה דחופה
שלב 2: הודעה מהירה אחרי 3 שעות
שלב 3: תזכורת אחרי 12 שעות
```

### 6. 📱 טיפוח ליד ממדיה ממומנת

```
טריגר: מקור Facebook/Google Ads/LinkedIn

שלב 0: הודעה ממותגת מיידית
שלב 1: שיתוף תוכן אחרי יום
שלב 2: הצעת פגישה אחרי 3 ימים
```

## 🔧 הגדרות מתקדמות

### יצירת תבנית חדשה

1. לך ל-"אוטומציות טיפוח"
2. לחץ "תבנית חדשה"
3. הגדר:
   - **שם** - תיאור קצר
   - **טריגר** - מתי להפעיל
   - **תנאים** - מקור, ציון, וכו'
   - **רצף** - שלבים עם הודעות וזמנים

### דוגמה ליצירת תבנית:

```javascript
POST /api/lead-nurturing/templates

{
  "name": "Follow-up לליד מההרצאה",
  "description": "רצף מותאם ללידים שהגיעו מההרצאה",
  "trigger": {
    "type": "new_lead",
    "conditions": {
      "tags": ["הרצאה"],
      "minLeadScore": 40
    }
  },
  "sequence": [
    {
      "step": 0,
      "delayDays": 0,
      "actionType": "send_whatsapp",
      "content": {
        "message": "היי {name}! 👋\n\nנעים היה לפגוש אותך בהרצאה!\n\nאשמח להמשיך את השיחה 😊"
      },
      "stopIfResponse": true
    },
    {
      "step": 1,
      "delayDays": 2,
      "actionType": "send_whatsapp",
      "content": {
        "message": "שלום {name},\n\nהכנתי עבורך חומר נוסף על הנושאים שדיברנו עליהם.\n\nרוצה לקבל?"
      },
      "stopIfResponse": true
    }
  ],
  "isActive": true
}
```

## 🧪 בדיקות

### בדיקה ידנית של הטריגרים

```bash
# הרץ את כל הבדיקות
curl http://localhost:5000/api/test/run-reminders
```

### בדיקת רצף ספציפי

```bash
# הפעל רצף על ליד ידנית
POST http://localhost:5000/api/lead-nurturing/instances/trigger

{
  "templateId": "TEMPLATE_ID",
  "clientId": "CLIENT_ID"
}
```

### צפייה בלוגים

```bash
# בטרמינל של השרת תראה:

🔍 Checking for nurturing triggers...
  ✨ Started nurturing for יוסי כהן
  💬 Sent WhatsApp to יוסי כהן
  ✅ Created task for יוסי כהן
```

## 📊 ניטור וסטטיסטיקות

### API Endpoints

```bash
# כל התבניות
GET /api/lead-nurturing/templates

# תבנית ספציפית
GET /api/lead-nurturing/templates/:id

# כל המופעים הפעילים
GET /api/lead-nurturing/instances?status=active

# סטטיסטיקות
GET /api/lead-nurturing/stats

# הפסקת רצף
POST /api/lead-nurturing/instances/stop/:id
```

## 🐛 Troubleshooting

### הרצפים לא מתחילים?

**בדיקה:**

```bash
# וודא שהשירות פעיל
curl http://localhost:5000/api/automation/status
```

**אמור לראות:**

```json
{
  "success": true,
  "data": {
    "active": true,
    "jobCount": 5
  }
}
```

### הודעות לא נשלחות?

1. וודא ש-WhatsApp Service מחובר
2. בדוק שיש מספר טלפון תקין
3. ראה לוגים: `console.log` בטרמינל

### ליד לא נכנס לרצף?

**בדוק:**

- האם התבנית פעילה? (isActive: true)
- האם הליד עומד בתנאים? (leadScore, leadSource, etc.)
- האם כבר יש מופע פעיל לליד הזה?

## 💡 טיפים לשימוש

### ✅ עשה:

- הזן לידים מיד כשהם נכנסים
- עקוב אחר "רצפים פעילים" יומית
- כבה תבניות שלא עובדות טוב
- התאם הודעות לקהל שלך

### ❌ אל תעשה:

- אל תשלח יותר מדי הודעות (מקסימום 3-4)
- אל תעתיק הודעות זהות בכל התבניות
- אל תשכח להפסיק רצף אם דיברת עם הליד
- אל תשאיר תבניות פעילות שלא מעקבות אחריהן

## 🎯 מדדי הצלחה

**תבנית טובה:**

- 60%+ completion rate
- 40%+ response rate (הליד הגיב)
- פחות מ-20% לא מגיבים

**תבנית שצריכה שיפור:**

- פחות מ-30% completion rate
- יותר מ-50% stopped (לא מגיבים)

## 🚀 מה הלאה?

1. **צור תבניות מותאמות** לסוגי לידים שונים
2. **עקוב אחר הסטטיסטיקות** ושפר הודעות
3. **שלב עם WhatsApp Business API** לשליחה אמיתית
4. **הוסף Email Templates** לגיוון
5. **בנה A/B Testing** להשוואת הודעות

---

**🎉 המערכת מוכנה! כל ליד חדש יטופל אוטומטית!**

